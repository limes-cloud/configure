import{aE as R,d as ne,E as l,au as oe,$ as ae,b3 as ue,B as le,b4 as se,b5 as ie,aU as re,az as de,aw as ce,e as U,f as _,ac as k,k as y,w as a,g as u,M as I,ab as ve,a$ as me,o as m,h as C,a2 as pe,a3 as fe,t as _e,aW as ge,aA as Fe,aN as be,_ as ye}from"./index.b4c32530.js";/* empty css               *//* empty css               */import{b as Ce,p as Ee}from"./template.1191e85f.js";import Be from"./compare.a6813f2b.js";function $e(d){return R.put("/configure/v1/configure",d)}function he(d){return R.post("/configure/v1/configure/compare",d)}const we={class:"configure"},ke={class:"header"},De={class:"header-item"},Ve={class:"header-item"},Se={class:"header-item"},Oe={class:"edit"},Te=ne({__name:"center",props:{template:null,envs:null},emits:["submit","sync"],setup(d,{emit:D}){const i=d,V="submit",E="sync",S="preview",O=l(),c=l(!1),r=l(""),p=l(!1),T=l(),s=l({}),g=l(!1),$=l(),v=l({}),n=oe({description:"",content:"",format:"json"}),f=l(!1),F=l(""),B=l([]),M=async()=>(n.description=v.value.description,n.format==="json"?n.content=JSON.stringify(JSON.parse(n.content)):F.value=n.content,D("submit",n),!0),j=()=>{var o;return D("sync",{server_id:(o=i.template)==null?void 0:o.server_id,env_id:s.value.env_id,description:v.value.description}),!0},P=async()=>{var e;const{data:o}=await Ce({id:(e=i.template)==null?void 0:e.id,content:n.content,format:n.format});if(!o.list.length){I.error("\u6A21\u677F\u4E0D\u5B58\u5728\u53D8\u66F4");return}r.value=V,c.value=!0,B.value=o.list},J=async()=>{var e;const{data:o}=await he({server_id:(e=i.template)==null?void 0:e.server_id,env_id:s.value.env_id});if(!o.list.length){I.error("\u914D\u7F6E\u4E0D\u5B58\u5728\u53D8\u66F4");return}c.value=!0,B.value=o.list},L=()=>(c.value=!1,v.value.description="",g.value=!0,!0),q=async()=>{r.value===V&&M(),r.value===E&&j()},z=()=>{p.value=!0,s.value.env_id=void 0,s.value.title="\u9884\u89C8",r.value=S},G=()=>{p.value=!0,s.value.env_id=void 0,s.value.title="\u540C\u6B65",r.value=E},W=async()=>{var e;const{data:o}=await Ee({content:n.content,format:n.format,env_id:s.value.env_id,server_id:(e=i.template)==null?void 0:e.server_id});n.format==="json"?F.value=JSON.stringify(JSON.parse(o.content),null,3):F.value=o.content,f.value=!0},Y=async()=>await T.value.validate()?!1:(r.value===S&&W(),r.value===E&&J(),!0);return ae(()=>i.template,o=>{!o||(n.content=o.content,n.format=o.format,O.value.setEditLang(o.format))},{deep:!0}),(o,e)=>{const H=ue,h=le,K=se,Q=ie,x=ve("CodeEditor"),X=ge,Z=re,A=Fe,N=de,b=me,ee=ce,w=be("permission");return m(),U("div",we,[_("div",ke,[_("div",De,[k((m(),y(h,{type:"primary",status:"success",disabled:!i.template,onClick:z},{icon:a(()=>[u(H)]),default:a(()=>[C(" \u751F\u6210\u9884\u89C8 ")]),_:1},8,["disabled"])),[[w,"configure:configure:preview"]])]),_("div",Ve,[k((m(),y(h,{type:"primary",disabled:!i.template,onClick:P},{icon:a(()=>[u(K)]),default:a(()=>[C(" \u63D0\u4EA4\u6A21\u677F ")]),_:1},8,["disabled"])),[[w,"configure:template:add"]])]),_("div",Se,[k((m(),y(h,{type:"primary",disabled:!i.template,onClick:G},{icon:a(()=>[u(Q)]),default:a(()=>[C(" \u540C\u6B65\u914D\u7F6E ")]),_:1},8,["disabled"])),[[w,"configure:configure:sync"]])])]),_("div",Oe,[u(x,{ref_key:"coder",ref:O,modelValue:n.content,"onUpdate:modelValue":e[0]||(e[0]=t=>n.content=t),lang:n.format,"show-line":!1,"switch-lang":!0,style:{width:"100%",height:"100%"},onChangeLang:e[1]||(e[1]=t=>{n.format=t})},null,8,["modelValue","lang"])]),u(b,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=t=>p.value=t),simple:"",title:"\u8BF7\u9009\u62E9\u73AF\u5883",onCancel:e[4]||(e[4]=t=>p.value=!1),onBeforeOk:Y},{default:a(()=>[u(N,{ref_key:"envFormRef",ref:T,model:s.value,layout:"vertical"},{default:a(()=>[u(A,{field:"env_id",label:"\u8BF7\u9009\u62E9\u9700\u8981"+s.value.title+"\u7684\u73AF\u5883",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u6E32\u67D3\u7684\u73AF\u5883"}],"validate-trigger":["change","input"]},{default:a(()=>[u(Z,{modelValue:s.value.env_id,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.env_id=t),"allow-search":"",placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[(m(!0),U(pe,null,fe(d.envs,(t,te)=>(m(),y(X,{key:te,value:t.id},{default:a(()=>[C(_e(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible"]),u(b,{visible:f.value,"onUpdate:visible":e[5]||(e[5]=t=>f.value=t),title:"\u914D\u7F6E\u8BE6\u60C5",width:"900px","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[6]||(e[6]=t=>f.value=!1),onBeforeOk:e[7]||(e[7]=t=>f.value=!1)},{default:a(()=>[u(x,{value:F.value,lang:n.format,"show-line":!1,"read-only":!0,style:{width:"100%",height:"100%"}},null,8,["value","lang"])]),_:1},8,["visible"]),u(b,{visible:c.value,"onUpdate:visible":e[8]||(e[8]=t=>c.value=t),title:"\u53D8\u66F4\u8BE6\u60C5",width:"900px","ok-text":"\u786E\u8BA4\u53D8\u66F4","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[9]||(e[9]=t=>c.value=!1),onBeforeOk:L},{default:a(()=>[u(Be,{data:B.value},null,8,["data"])]),_:1},8,["visible"]),u(b,{visible:g.value,"onUpdate:visible":e[11]||(e[11]=t=>g.value=t),simple:"",title:"\u53D8\u66F4\u63CF\u8FF0",onCancel:e[12]||(e[12]=t=>g.value=!1),onBeforeOk:q},{default:a(()=>[u(N,{ref_key:"descFormRef",ref:$,model:v.value,layout:"vertical"},{default:a(()=>[u(A,{field:"description",label:"\u8BF7\u7B80\u8981\u6982\u8FF0\u4E00\u4E0B\u672C\u6B21\u63D0\u4EA4\u7684\u4FEE\u6539",rules:[{required:!0,message:"\u6A21\u677F\u63CF\u8FF0\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:a(()=>[u(ee,{modelValue:v.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value.description=t),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}});const xe=ye(Te,[["__scopeId","data-v-011c84f7"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{xe as C,Me as c,$e as s};
