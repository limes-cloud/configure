import{s as R,A as ne,B as ae,_ as oe}from"./index.dcee45e5.js";import{d as ue,e as s,r as le,w as se,bh as ie,T as re,b6 as de,b9 as ce,b1 as ve,B as N,E as _,bE as w,aC as y,aJ as o,aK as u,aG as U,aX as me,aH as pe,b_ as fe,A as v,aM as E,aO as _e,aL as be,aN as Fe,be as ge,ba as Ce}from"./arco.5cfe922d.js";import{b as ye,P as Ee}from"./api.a38eaf14.js";import Be from"./compare.d1a9010b.js";function Pe(m){return R.put("/configure/api/v1/configure",m)}function Ie(m){return R.post("/configure/api/v1/configure/compare",m)}const he={class:"configure"},we={class:"header"},De={class:"header-item"},Ve={class:"header-item"},ke={class:"header-item"},Se={class:"edit"},D="submit",V="sync",P="preview",Oe=ue({__name:"center",props:{template:{},envs:{}},emits:["submit","sync"],setup(m,{emit:M}){const i=m,k=M,c=s(!1),r=s(""),p=s(!1),S=s(),l=s({}),b=s(!1),j=s(),d=s({}),n=le({description:"",content:"",format:"json"}),f=s(!1),F=s(""),B=s([]),J=async()=>(n.description=d.value.description,n.format==="json"?n.content=JSON.stringify(JSON.parse(n.content)):F.value=n.content,k("submit",n),!0),$=()=>{var a;return k("sync",{serverId:(a=i.template)==null?void 0:a.serverId,envId:l.value.envId,description:d.value.description}),!0},L=async()=>{var e,g;if(!((e=i.template)!=null&&e.id)){r.value=D,d.value.description="\u521D\u59CB\u5316\u63D0\u4EA4",O();return}const{data:a}=await ye({id:(g=i.template)==null?void 0:g.id,content:n.content,format:n.format});if(!a.list.length){U.error("\u6A21\u677F\u4E0D\u5B58\u5728\u53D8\u66F4");return}r.value=D,c.value=!0,B.value=a.list},G=async()=>{var e;const{data:a}=await Ie({serverId:(e=i.template)==null?void 0:e.serverId,envId:l.value.envId});if(!a.list.length){U.error("\u914D\u7F6E\u4E0D\u5B58\u5728\u53D8\u66F4");return}c.value=!0,B.value=a.list},q=()=>(c.value=!1,d.value.description="",b.value=!0,!0),O=async()=>{r.value===D&&J(),r.value===V&&$()},z=()=>{p.value=!0,l.value.envId=void 0,l.value.title="\u9884\u89C8",r.value=P},H=()=>{p.value=!0,l.value.envId=void 0,l.value.title="\u540C\u6B65",r.value=V},K=async()=>{var e;const{data:a}=await Ee({content:n.content,format:n.format,envId:l.value.envId,serverId:(e=i.template)==null?void 0:e.serverId});n.format==="json"?F.value=JSON.stringify(JSON.parse(a.content),null,3):F.value=a.content,f.value=!0},W=async()=>await S.value.validate()?!1:(r.value===P&&K(),r.value===V&&G(),!0);return se(()=>i.template,a=>{!a||(n.content=a.content,n.format=a.format)},{deep:!0}),(a,e)=>{const g=ne,I=ie,X=re,Y=ae,T=me("CodeEditor"),Q=ge,Z=de,A=Ce,x=ce,C=pe,ee=ve,h=fe("permission");return v(),N("div",he,[_("div",we,[_("div",De,[w((v(),y(I,{type:"primary",status:"success",disabled:!i.template,onClick:z},{icon:o(()=>[u(g)]),default:o(()=>[E(" \u751F\u6210\u9884\u89C8 ")]),_:1},8,["disabled"])),[[h,"configure:template:preview"]])]),_("div",Ve,[w((v(),y(I,{type:"primary",disabled:!i.template,onClick:L},{icon:o(()=>[u(X)]),default:o(()=>[E(" \u63D0\u4EA4\u6A21\u677F ")]),_:1},8,["disabled"])),[[h,"configure:template:add"]])]),_("div",ke,[w((v(),y(I,{type:"primary",disabled:!i.template,onClick:H},{icon:o(()=>[u(Y)]),default:o(()=>[E(" \u540C\u6B65\u914D\u7F6E ")]),_:1},8,["disabled"])),[[h,"configure:configure:sync"]])])]),_("div",Se,[u(T,{modelValue:n.content,"onUpdate:modelValue":e[0]||(e[0]=t=>n.content=t),lang:n.format,"show-line":!1,"show-switch-lang":!0,"show-fullscreen":!0,style:{width:"100%",height:"100%"},onChangeLang:e[1]||(e[1]=t=>{n.format=t})},null,8,["modelValue","lang"])]),u(C,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=t=>p.value=t),simple:"",title:"\u8BF7\u9009\u62E9\u73AF\u5883",onCancel:e[4]||(e[4]=t=>p.value=!1),onBeforeOk:W},{default:o(()=>[u(x,{ref_key:"envFormRef",ref:S,model:l.value,layout:"vertical"},{default:o(()=>[u(A,{field:"envId",label:"\u8BF7\u9009\u62E9\u9700\u8981"+l.value.title+"\u7684\u73AF\u5883",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u6E32\u67D3\u7684\u73AF\u5883"}],"validate-trigger":["change","input"]},{default:o(()=>[u(Z,{modelValue:l.value.envId,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.envId=t),"allow-search":"",placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(v(!0),N(_e,null,be(a.envs,(t,te)=>(v(),y(Q,{key:te,value:t.id},{default:o(()=>[E(Fe(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible"]),u(C,{visible:f.value,"onUpdate:visible":e[5]||(e[5]=t=>f.value=t),title:"\u914D\u7F6E\u8BE6\u60C5",width:"900px","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[6]||(e[6]=t=>f.value=!1),onBeforeOk:e[7]||(e[7]=t=>f.value=!1)},{default:o(()=>[u(T,{value:F.value,lang:n.format,"show-line":!1,"read-only":!0,style:{width:"100%",height:"100%"}},null,8,["value","lang"])]),_:1},8,["visible"]),u(C,{visible:c.value,"onUpdate:visible":e[8]||(e[8]=t=>c.value=t),title:"\u53D8\u66F4\u8BE6\u60C5",width:"900px","ok-text":"\u786E\u8BA4\u53D8\u66F4","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[9]||(e[9]=t=>c.value=!1),onBeforeOk:q},{default:o(()=>[u(Be,{data:B.value},null,8,["data"])]),_:1},8,["visible"]),u(C,{visible:b.value,"onUpdate:visible":e[11]||(e[11]=t=>b.value=t),simple:"",title:"\u53D8\u66F4\u63CF\u8FF0",onCancel:e[12]||(e[12]=t=>b.value=!1),onBeforeOk:O},{default:o(()=>[u(x,{ref_key:"descFormRef",ref:j,model:d.value,layout:"vertical"},{default:o(()=>[u(A,{field:"description",label:"\u8BF7\u7B80\u8981\u6982\u8FF0\u4E00\u4E0B\u672C\u6B21\u63D0\u4EA4\u7684\u4FEE\u6539",rules:[{required:!0,message:"\u6A21\u677F\u63CF\u8FF0\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:o(()=>[u(ee,{modelValue:d.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.description=t),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}});const Te=oe(Oe,[["__scopeId","data-v-d8af2b08"]]),Re=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Te as C,Pe as S,Re as c};
