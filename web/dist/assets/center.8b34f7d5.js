import{v as M,z as ae,A as oe,_ as ue}from"./index.ddbbfbf8.js";import{d as le,e as l,r as se,w as re,bh as ie,T as de,b6 as ce,b9 as ve,b1 as me,B as U,E as _,bE as w,aC as y,aJ as o,aK as u,aG as P,aX as pe,aH as fe,b_ as _e,A as v,aM as E,aO as be,aL as ge,aN as Fe,be as Ce,ba as ye}from"./arco.b1c3a1f5.js";import{b as Ee,P as Be}from"./api.6d9c888a.js";import Ie from"./compare.f54d7013.js";function Re(m){return M.put("/configure/api/v1/configure",m)}function he(m){return M.post("/configure/api/v1/configure/compare",m)}const we={class:"configure"},De={class:"header"},ke={class:"header-item"},Ve={class:"header-item"},Se={class:"header-item"},Oe={class:"edit"},D="submit",k="sync",R="preview",Te=le({__name:"center",props:{template:{},envs:{}},emits:["submit","sync"],setup(m,{emit:j}){const r=m,V=j,S=l(),c=l(!1),i=l(""),p=l(!1),O=l(),s=l({}),b=l(!1),J=l(),d=l({}),a=se({description:"",content:"",format:"json"}),f=l(!1),g=l(""),B=l([]),L=async()=>(a.description=d.value.description,a.format==="json"?a.content=JSON.stringify(JSON.parse(a.content)):g.value=a.content,V("submit",a),!0),$=()=>{var n;return V("sync",{serverId:(n=r.template)==null?void 0:n.serverId,envId:s.value.envId,description:d.value.description}),!0},G=async()=>{var e,F;if(!((e=r.template)!=null&&e.id)){i.value=D,d.value.description="\u521D\u59CB\u5316\u63D0\u4EA4",T();return}const{data:n}=await Ee({id:(F=r.template)==null?void 0:F.id,content:a.content,format:a.format});if(!n.list.length){P.error("\u6A21\u677F\u4E0D\u5B58\u5728\u53D8\u66F4");return}i.value=D,c.value=!0,B.value=n.list},q=async()=>{var e;const{data:n}=await he({serverId:(e=r.template)==null?void 0:e.serverId,envId:s.value.envId});if(!n.list.length){P.error("\u914D\u7F6E\u4E0D\u5B58\u5728\u53D8\u66F4");return}c.value=!0,B.value=n.list},z=()=>(c.value=!1,d.value.description="",b.value=!0,!0),T=async()=>{i.value===D&&L(),i.value===k&&$()},H=()=>{p.value=!0,s.value.envId=void 0,s.value.title="\u9884\u89C8",i.value=R},K=()=>{p.value=!0,s.value.envId=void 0,s.value.title="\u540C\u6B65",i.value=k},W=async()=>{var e;const{data:n}=await Be({content:a.content,format:a.format,envId:s.value.envId,serverId:(e=r.template)==null?void 0:e.serverId});a.format==="json"?g.value=JSON.stringify(JSON.parse(n.content),null,3):g.value=n.content,f.value=!0},X=async()=>await O.value.validate()?!1:(i.value===R&&W(),i.value===k&&q(),!0);return re(()=>r.template,n=>{!n||(a.content=n.content,a.format=n.format,S.value.setEditLang(n.format))},{deep:!0}),(n,e)=>{const F=ae,I=ie,Y=de,Q=oe,A=pe("CodeEditor"),Z=Ce,ee=ce,x=ye,N=ve,C=fe,te=me,h=_e("permission");return v(),U("div",we,[_("div",De,[_("div",ke,[w((v(),y(I,{type:"primary",status:"success",disabled:!r.template,onClick:H},{icon:o(()=>[u(F)]),default:o(()=>[E(" \u751F\u6210\u9884\u89C8 ")]),_:1},8,["disabled"])),[[h,"configure:template:preview"]])]),_("div",Ve,[w((v(),y(I,{type:"primary",disabled:!r.template,onClick:G},{icon:o(()=>[u(Y)]),default:o(()=>[E(" \u63D0\u4EA4\u6A21\u677F ")]),_:1},8,["disabled"])),[[h,"configure:template:add"]])]),_("div",Se,[w((v(),y(I,{type:"primary",disabled:!r.template,onClick:K},{icon:o(()=>[u(Q)]),default:o(()=>[E(" \u540C\u6B65\u914D\u7F6E ")]),_:1},8,["disabled"])),[[h,"configure:configure:sync"]])])]),_("div",Oe,[u(A,{ref_key:"coder",ref:S,modelValue:a.content,"onUpdate:modelValue":e[0]||(e[0]=t=>a.content=t),lang:a.format,"show-line":!1,"switch-lang":!0,style:{width:"100%",height:"100%"},onChangeLang:e[1]||(e[1]=t=>{a.format=t})},null,8,["modelValue","lang"])]),u(C,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=t=>p.value=t),simple:"",title:"\u8BF7\u9009\u62E9\u73AF\u5883",onCancel:e[4]||(e[4]=t=>p.value=!1),onBeforeOk:X},{default:o(()=>[u(N,{ref_key:"envFormRef",ref:O,model:s.value,layout:"vertical"},{default:o(()=>[u(x,{field:"envId",label:"\u8BF7\u9009\u62E9\u9700\u8981"+s.value.title+"\u7684\u73AF\u5883",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u6E32\u67D3\u7684\u73AF\u5883"}],"validate-trigger":["change","input"]},{default:o(()=>[u(ee,{modelValue:s.value.envId,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.envId=t),"allow-search":"",placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(v(!0),U(be,null,ge(n.envs,(t,ne)=>(v(),y(Z,{key:ne,value:t.id},{default:o(()=>[E(Fe(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible"]),u(C,{visible:f.value,"onUpdate:visible":e[5]||(e[5]=t=>f.value=t),title:"\u914D\u7F6E\u8BE6\u60C5",width:"900px","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[6]||(e[6]=t=>f.value=!1),onBeforeOk:e[7]||(e[7]=t=>f.value=!1)},{default:o(()=>[u(A,{value:g.value,lang:a.format,"show-line":!1,"read-only":!0,style:{width:"100%",height:"100%"}},null,8,["value","lang"])]),_:1},8,["visible"]),u(C,{visible:c.value,"onUpdate:visible":e[8]||(e[8]=t=>c.value=t),title:"\u53D8\u66F4\u8BE6\u60C5",width:"900px","ok-text":"\u786E\u8BA4\u53D8\u66F4","unmount-on-close":"","body-style":{height:"500px",padding:"0"},onCancel:e[9]||(e[9]=t=>c.value=!1),onBeforeOk:z},{default:o(()=>[u(Ie,{data:B.value},null,8,["data"])]),_:1},8,["visible"]),u(C,{visible:b.value,"onUpdate:visible":e[11]||(e[11]=t=>b.value=t),simple:"",title:"\u53D8\u66F4\u63CF\u8FF0",onCancel:e[12]||(e[12]=t=>b.value=!1),onBeforeOk:T},{default:o(()=>[u(N,{ref_key:"descFormRef",ref:J,model:d.value,layout:"vertical"},{default:o(()=>[u(x,{field:"description",label:"\u8BF7\u7B80\u8981\u6982\u8FF0\u4E00\u4E0B\u672C\u6B21\u63D0\u4EA4\u7684\u4FEE\u6539",rules:[{required:!0,message:"\u6A21\u677F\u63CF\u8FF0\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:o(()=>[u(te,{modelValue:d.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.description=t),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}});const Ae=ue(Te,[["__scopeId","data-v-2b9daf47"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));export{Ae as C,Re as S,Me as c};
