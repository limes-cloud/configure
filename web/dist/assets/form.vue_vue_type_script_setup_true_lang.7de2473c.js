import"./index.dcee45e5.js";/* empty css              */import{d as S,e as i,b1 as A,c0 as R,b4 as k,b6 as I,b2 as q,b9 as L,bH as G,aC as f,aJ as r,aG as F,A as C,aK as l,aM as B,u as _,aD as N,ba as T,bc as M}from"./arco.5cfe922d.js";import{G as j,C as z,U as H}from"./api.6c539ed8.js";import{S as J}from"./search.f33d2c59.js";import{L as K}from"./api.64a2d5f2.js";const ae=S({__name:"form",emits:["refresh"],setup(O,{expose:g,emit:w}){const c=i(),d=i(!1),n=i(!1),u=i({}),D=w,m=i([]),p=new J(m.value,async o=>{const e=[],{data:s}=await K({...o,status:!0,name:o.query});return s.list.forEach(t=>{e.push({label:t.name,value:t.id})}),e},o=>{var e;return!!((e=u.value.serverIds)!=null&&e.includes(o))});p.Search(),g({showAddDrawer:()=>{d.value=!0,n.value=!0},showUpdateDrawer:async o=>{u.value={};const{data:e}=await j({id:o}),s=[];e.private&&e.servers.forEach(t=>{m.value.push({label:t.name,value:t.id}),s.push(t.id)}),u.value={...e,fieldList:e.fields.split(","),serverIds:s},d.value=!0,n.value=!1},closeDrawer:()=>{d.value=!1}});const b=async()=>{if(await c.value.validate())return!1;const e={...u.value};return e.fields=e.fieldList.join(","),n.value?(await z({...e}),F.success("\u521B\u5EFA\u6210\u529F")):(await H(e),F.success("\u66F4\u65B0\u6210\u529F")),D("refresh"),!0};return(o,e)=>{const s=A,t=T,h=R,v=k,V=M,E=I,y=q,U=L,x=G;return C(),f(x,{visible:d.value,"onUpdate:visible":e[6]||(e[6]=a=>d.value=a),title:n.value?"\u65B0\u5EFA":"\u4FEE\u6539",width:"380px",onCancel:e[7]||(e[7]=a=>d.value=!1),onBeforeOk:b},{default:r(()=>[l(U,{ref_key:"formRef",ref:c,model:u.value,"label-align":"left",layout:"horizontal","auto-label-width":""},{default:r(()=>[l(t,{field:"keyword",label:"\u53D8\u91CF\u6807\u8BC6",rules:[{required:!0,message:"\u53D8\u91CF\u6807\u8BC6\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(s,{modelValue:u.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.keyword=a),disabled:!n.value,placeholder:"\u8BF7\u8F93\u5165\u53D8\u91CF\u6807\u8BC6","allow-clear":""},null,8,["modelValue","disabled"])]),_:1}),l(t,{field:"tag",label:"\u53D8\u91CF\u6807\u7B7E",rules:[{required:!0,message:"\u53D8\u91CF\u6807\u7B7E\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(s,{modelValue:u.value.tag,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.tag=a),placeholder:"\u8BF7\u8F93\u5165\u53D8\u91CF\u6807\u7B7E","allow-clear":""},null,8,["modelValue"])]),_:1}),l(t,{field:"fieldList",label:"\u53D8\u91CF\u5B57\u6BB5",rules:[{required:!0,message:"\u53D8\u91CF\u5B57\u6BB5\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(h,{modelValue:u.value.fieldList,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.fieldList=a),placeholder:"\u8BF7\u8F93\u5165\u53D8\u91CF\u5B57\u6BB5","unique-value":"","allow-clear":""},null,8,["modelValue"])]),_:1}),l(t,{field:"private",label:"\u53D8\u91CF\u7C7B\u578B",rules:[{required:!0,message:"\u53D8\u91CF\u7C7B\u578B\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(V,{modelValue:u.value.private,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.private=a)},{default:r(()=>[l(v,{value:!0},{default:r(()=>[B("\u79C1\u6709\u53D8\u91CF")]),_:1}),l(v,{value:!1},{default:r(()=>[B("\u516C\u5171\u53D8\u91CF")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u.value.private?(C(),f(t,{key:0,field:"serverIds",label:"\u6240\u5C5E\u670D\u52A1",rules:[{required:!0,message:"\u6240\u5C5E\u670D\u52A1\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(E,{modelValue:u.value.serverIds,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.serverIds=a),placeholder:"\u8BF7\u9009\u62E9\u53D8\u91CF\u6240\u5C5E\u670D\u52A1",multiple:"","max-tag-count":2,scrollbar:!0,options:m.value,"allow-search":"",onSearch:_(p).Search,onDropdownReachBottom:_(p).NextSearch},null,8,["modelValue","options","onSearch","onDropdownReachBottom"])]),_:1})):N("",!0),l(t,{field:"description",label:"\u53D8\u91CF\u63CF\u8FF0",rules:[{required:!0,message:"\u53D8\u91CF\u63CF\u8FF0\u662F\u5FC5\u586B\u9879"}],"validate-trigger":["change","input"]},{default:r(()=>[l(y,{modelValue:u.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.description=a),placeholder:"\u8BF7\u8F93\u5165\u53D8\u91CF\u63CF\u8FF0","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])}}});export{ae as _};
